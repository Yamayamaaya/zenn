---
title: "複数のファイルの位置関係を出力したい"
emoji: "🍣"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: [markdown]
published: false
---

# はじめに

複雑なプロジェクトや大きなプロジェクトでは、ファイルの位置関係を把握するのが難しいことがあると思います。また、状況を知らない先輩や chatGPT に質問する際に、ファイルの位置関係は重要な要素になります。tree コマンドや find コマンドの組み合わせでも対応できるかと思いますが、より簡単に、直感的にファイルの位置関係を把握できるツールがあれば便利だと思いました。

# 開発記録

1.  欲しい機能（要件）
2.  最小実装

    -   chatGPT と協力しながらシェルスクリプトを作成し、直接実行する
    -   対象ファイルを検索し、現在のディレクトリからそのファイルまでのツリーを出力するようにする

    ```zsh:test.sh
      #!/bin/zsh

      # 検索するファイル名
      TARGET_FILE="Payjp.tsx"

      # 現在のディレクトリからファイルを検索し、その相対パスを取得
      FOUND_PATH=$(find . -type f -name "$TARGET_FILE")

      if [[ -z "$FOUND_PATH" ]]; then
          echo "The target file '$TARGET_FILE' was not found in the current directory or any subdirectories."
      else
          # ファイルが存在する場合、その位置をツリー表示
          tree -P "$TARGET_FILE" --prune
      fi

    ```

    -   OpenAI の公式リポジトリの一つである openai-cookbook を clone し、動作確認します。

    ```zsh:test.sh
        #!/bin/zsh

        # 検索するファイル名
        TARGET_FILE="what_makes_documentation_good.md"

        # 現在のディレクトリからファイルを検索し、その相対パスを取得
        FOUND_PATH=$(find . -type f -name "$TARGET_FILE")

        if [[ -z "$FOUND_PATH" ]]; then
            echo "The target file '$TARGET_FILE' was not found in the current directory or any subdirectories."
        else
            # ファイルが存在する場合、その位置をツリー表示
            tree -P "$TARGET_FILE" --prune
        fi

    ```

    実行結果

    ```zsh
      $ ../test.sh
      .
      └── articles
          └── what_makes_documentation_good.md

      2 directories, 1 file
    ```

    期待通り

3.  改良

    1. ファイル名を引数で受け取れるようにする

    ```diff zsh:test.sh
    - # 検索するファイル名
    - TARGET_FILE="what_makes_documentation_good.md"

    + # コマンドライン引数から検索するファイル名を取得
    + TARGET_FILE="$1"
    ```

    2. 複数のファイルを同時に検索できるようにする

    ```diff zsh:test.sh

    #!/bin/zsh

    +  コマンドライン引数が指定されていない場合はエラーメッセージを表示
    + if [[ $# -eq 0 ]]; then
    +     echo "Error: No target files specified."
    +     echo "Usage: $0 <target_file_name1> <target_file_name2> ..."
    +     exit 1

    + # 各ファイルに対して検索とツリー表示を実行
    + for TARGET_FILE in "$@"; do
    +     echo "Searching for '$TARGET_FILE':"
    - # コマンドライン引数から検索するファイル名を取得
    - TARGET_FILE="$1"
    -
    - if [[ -z "$TARGET_FILE" ]]; then
    -     echo "Error: No target file specified."
    -     echo "Usage: $0 <target_file_name>"
    -     exit 1
    - fi

        # 現在のディレクトリからファイルを検索し、その相対パスを取得
        FOUND_PATHS=$(find . -type f -name "$TARGET_FILE")

        if [[ -z "$FOUND_PATHS" ]]; then
            echo "  The target file '$TARGET_FILE' was not found in the current directory or any subdirectories."
        else
            # ファイルが存在する場合、その位置をツリー表示
    +         echo "$FOUND_PATHS" | while read -r FOUND_PATH; do
    +             DIR_PATH=$(dirname "$FOUND_PATH")
    +             echo "  Found in directory '$DIR_PATH':"
                  tree "$DIR_PATH" -P "$TARGET_FILE" --prune
    +         done
        fi

    +     echo ""  # 空行を挿入して結果を区切る
    + done


    ```
